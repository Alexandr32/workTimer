<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="vanilla-tilt.js"></script>
    <script type="text/javascript" src="moment.js"></script>
    <script type="text/javascript" src="moment-with-locales.js"></script>
</head>
<body>

<template id="templateDrop">
    <div class="drop"></div>
</template>

<div class="timer">
    <div class="text-label">
        До конца рабочего дня осталось:
    </div>

    <div class="time">

        <div class="circle">
            <div id="hour" class="title">
                00
            </div>
            <div class="name">
                Часы
            </div>

            <div class="dots hh-dot dot-red"></div>

            <svg  height='100%' width='100%' class="svg">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>

            <svg  height='100%' width='100%' class="svg red" id="hh-line">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>

        </div>

        <div class="circle">

            <div id="minute" class="title">
                00
            </div>
            <div class="name">
                Минуты
            </div>

            <div class="dots hh-dot dot-yellow"></div>

            <svg  height='100%' width='100%' class="svg">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>

            <svg  height='100%' width='100%' class="svg yellow" id="mm-line">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>
        </div>

        <div class="circle">

            <div id="second" class="title">
                00
            </div>
            <div class="name">
                Секунды
            </div>

            <div class="dots hh-dot dot-green"></div>

            <svg  height='100%' width='100%' class="svg">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>

            <svg  height='100%' width='100%' class="svg green" id="ss-line">
                <circle cx="100" cy="100" r="70"></circle>
            </svg>
        </div>

    </div>
</div>

</body>
</html>

<script>

    VanillaTilt.init(document.querySelectorAll('.timer'), {
        max: 25,
        speed: 400,
        scale: 1.2,
    });

    class Timer {
        constructor(hourElement, minuteElement, secondElement) {
            this.hourElement = hourElement
            this.minuteElement = minuteElement
            this.secondElement = secondElement
        }

        updateUI() {
            //const hourElement = document.getElementById('hour')
            //const minuteElement = document.getElementById('minute')
            //const secondElement = document.getElementById('second')

            const now  = moment(new Date());
            const then = moment(new Date());
            then.set({
                hour:   17,
                minute: 30,
            });

            const ms = now.diff(then);
            const diff = moment.duration(ms);

            //const currentHour = new Date().getHours()
            const currentHour = diff.hours()
            //const currentMinute = new Date().getMinutes()
            const currentMinute = diff.minutes()
            //const currentSecond = new Date().getSeconds()
            const currentSecond = diff.seconds()

            this.hourElement.innerHTML = currentHour
            this.minuteElement.innerHTML = currentMinute
            this.secondElement.innerHTML = currentSecond

            const hhLine = document.getElementById('hh-line')
            const mmLine = document.getElementById('mm-line')
            const ssLine = document.getElementById('ss-line')

            hhLine.style.strokeDashoffset = 440 - (440 * currentHour) / 12
            mmLine.style.strokeDashoffset = 440 - (440 * currentMinute) / 60
            ssLine.style.strokeDashoffset = 440 - (440 * currentSecond) / 60

            const dotRed = document.getElementsByClassName('dot-red')[0]
            const dotYellow = document.getElementsByClassName('dot-yellow')[0]
            const dotGreen = document.getElementsByClassName('dot-green')[0]

            dotRed.style.transform = `rotate(${currentHour * 30}deg)`
            dotYellow.style.transform = `rotate(${currentMinute * 6}deg)`
            dotGreen.style.transform = `rotate(${currentSecond * 6}deg)`
        }
    }

    class Rain {

        constructor(mainElement, templateDrop) {
            const amount = 80

            for (let i = 0; i < amount; i++) {

                const drop = templateDrop.content.cloneNode(true).children[0]

                const size = Math.random() * 5
                const posX = Math.floor(Math.random() * window.innerWidth)
                const delay = Math.random() * -20
                const duration = Math.random() * -20

                drop.style.width = `${0.2 + size}px`
                drop.style.left = `${posX}px`
                drop.style.animationDelay = `${delay}s`
                drop.style.animationDuration = `1${duration}s`

                mainElement.append(drop)
            }

        }
    }

    function main() {
        const timer = new Timer(
            document.getElementById('hour'),
            document.getElementById('minute'),
            document.getElementById('second'),
        )

        timer.updateUI()

        setInterval(() => {
            timer.updateUI()
        }, 1000)

        const body = document.querySelector('body')
        new Rain(body, templateDrop)
    }

    main()


</script>